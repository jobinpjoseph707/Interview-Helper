<div class="main-cointainer">
  <div class="candidate-info">
    <span class="name">
      <label>Name   :</label>
      <span class="value">{{ candidateName }}</span>
    </span>

    <span class="candidate-id">
      <label>Candidate ID    :</label>
      <span class="value">{{ candidateId }}</span>
    </span>
  </div>

<div class="interview-container">
    <nav class="tabs">
      @for (tab of tabs; track tab) {
        <button (click)="setActiveTab(tab)" [class.active]="activeTab === tab">
          {{ tab }}
        </button>
      }
    </nav>
  @for (question of filteredQuestions; track question.id;let i = $index) {
    <mat-card appearance="outlined" class="question-card">
      <mat-card-content>
        <div class="question-text">
          <p>{{ question.text }}</p>
        </div>
        <div class="answer-buttons">
          <button mat-icon-button (click)="answerQuestion(question.id, 'correct')" [class.selected]="question.answer === 'correct'">
            <mat-icon class="right-icon" [class.selected]="question.answer === 'correct'">check_circle</mat-icon>
          </button>
          <button mat-icon-button (click)="answerQuestion(question.id, 'incorrect')" [class.selected]="question.answer === 'incorrect'">
            <mat-icon class="wrong-icon" [class.selected]="question.answer === 'incorrect'">cancel</mat-icon>
          </button>
          <div class="timer">
            <mat-icon (click)="toggleTimer(question.id)" [ngStyle]="{ 'color': timers[question.id]?.isRunning ? 'rgb(202, 191, 143)' : 'white' }">
              {{ timers[question.id]?.isRunning ? 'pause_circle_filled' : 'play_circle_filled' }}
            </mat-icon>
            <span>{{ formatTime(timers[question.id]?.seconds ?? 0) }}</span>
          <!-- <mat-icon (click)="toggleTimer(question.id)" [ngStyle]="{ 'color': timers[question.id]?.isRunning ? 'rgb(202, 191, 143)' : 'white' }">
          {{ timers[question.id]?.isRunning ? 'pause_circle_filled' : 'play_circle_filled' }}
          </mat-icon> -->
          <!-- <span>{{ formatTime(timers[question.id]?.seconds??0) }}</span> -->
        </div>
      </div>
     </mat-card-content>
    </mat-card>
  }

</div>
<footer class="buttonpossition">
  <button class="finish-button" (click)="finishInterview()">Save</button>
</footer>



  </div>
  <!-- @if (showResultsModal) {
    <div class="modal-overlay">
      <div class="modal-content mat-elevation-z8">
        <button class="closemodel" mat-icon-button (click)="closeModal()">
          <mat-icon>close</mat-icon>
        </button>

        <h6>Candidate ID: {{ candidateId }}</h6>
        <h6>Name: {{ candidateName }}</h6>

        <mat-accordion>
          @for (role of roles; track role.name) {
            <mat-expansion-panel (opened)="setRoleExpanded(role, true)" (closed)="setRoleExpanded(role, false)">
              <mat-expansion-panel-header>
                <mat-panel-title>
                  Role: {{ role.name }}
                </mat-panel-title>
                <mat-panel-description>
                  Total Percentage: {{ role.percentage }}%
                </mat-panel-description>
              </mat-expansion-panel-header>

              @if (role.details) {
                <div>
                  <p>Right: {{ role.details.right }}</p>
                  <p>Wrong: {{ role.details.wrong }}</p>
                </div>
              }
            </mat-expansion-panel>
          }
        </mat-accordion>

        <div class="overall-percentage">
          <p>Overall Percentage: {{ overallPercentage }}%</p>
        </div>

        <div class="action-buttons">

          <button mat-raised-button  class="download-button" (click)="SubmitResults()">
            Submit
          </button>
        </div>
      </div>
    </div>
  }
  @if(showConfirmationModal){

    <div class="dialog-overlay">
      <div class="dialog-content">
        <h1 class="dialog-title">Confirm Finish</h1>
        <div class="dialog-body">
          <textarea
            [(ngModel)]="reviewText"
            placeholder="Write your review here..."
            rows="4"
            cols="50">
          </textarea>
          <p>Are you sure you want to finish the interview?</p>
        </div>
        <div class="dialog-footer">
          <button class="cancel-button" (click)="cancelFinish()">No</button>
          <button class="confirm-button" (click)="confirmFinish()">Yes</button>
        </div>
      </div>
    </div>

  } -->

<!-- Define modal templates -->
<ng-template #confirmationModalTemplate>
  <div class="dialog-content">
    <h1 class="dialog-title">Confirm Finish</h1>
    <div class="dialog-body">
      <textarea
        [(ngModel)]="reviewText"
        placeholder="Write your review here..."
        rows="4"
        cols="50">
      </textarea>
      <p>Are you sure you want to finish the interview?</p>
    </div>
    <div class="dialog-footer">
      <button class="cancel-button" (click)="cancelFinish()">No</button>
      <button class="confirm-button" (click)="confirmFinish()">Yes</button>
    </div>
  </div>
</ng-template>

<!-- <ng-template #resultsModalTemplate>
  <div class="modal-content ">
    <button class="closemodel" mat-icon-button (click)="closeModal()">
      <mat-icon>close</mat-icon>
    </button>

    <h6>Candidate ID: {{ candidateId }}</h6>
    <h6>Name: {{ candidateName }}</h6>

    <mat-accordion>
      <mat-expansion-panel *ngFor="let role of roles; trackBy: trackRoleByName" (opened)="setRoleExpanded(role, true)" (closed)="setRoleExpanded(role, false)">
        <mat-expansion-panel-header>
          <mat-panel-title>
            Role: {{ role.name }}
          </mat-panel-title>
          <mat-panel-description>
            Total Percentage: {{ role.percentage }}%
          </mat-panel-description>
        </mat-expansion-panel-header>

        <div *ngIf="role.details">
          <p>Right: {{ role.details.right }}</p>
          <p>Wrong: {{ role.details.wrong }}</p>
        </div>
      </mat-expansion-panel>
    </mat-accordion>

    <div class="overall-percentage">
      <p>Overall Percentage: {{ overallPercentage }}%</p>
    </div>

    <div class="action-buttons">

      <button mat-raised-button  class="download-button" (click)="SubmitResults()">
        Submit
      </button>
    </div>
  </div>
</ng-template> -->


<ng-template #resultsModalTemplate>
  <div class="modal-content">
    <button class="closemodel" mat-icon-button (click)="closeModal()">
      <mat-icon>close</mat-icon>
    </button>

    <div class="candidate-info">
      <h6>Candidate ID: {{ candidateId }}</h6>
      <h6>Name: {{ candidateName }}</h6>
    </div>

    <mat-accordion>
      <mat-expansion-panel *ngFor="let role of roles; trackBy: trackRoleByName" 
        (opened)="setRoleExpanded(role, true)" 
        (closed)="setRoleExpanded(role, false)">
        <mat-expansion-panel-header>
          <mat-panel-title>
            Role: {{ role.name }}
          </mat-panel-title>
          <mat-panel-description>
            Total Percentage: {{ role.percentage }}%
          </mat-panel-description>
        </mat-expansion-panel-header>

        <div *ngIf="role.details" class="role-details">
          <p>Right: {{ role.details.right }}</p>
          <p>Wrong: {{ role.details.wrong }}</p>
        </div>
      </mat-expansion-panel>
    </mat-accordion>

    <div class="overall-percentage">
      <p>Overall Percentage: {{ overallPercentage }}%</p>
    </div>

    <div class="action-buttons">
      <button mat-raised-button class="download-button" (click)="SubmitResults()">
        Submit
      </button>
    </div>
  </div>
</ng-template>
<!-- Remove the old modal sections -->
<!-- @if (showResultsModal) {... } -->
<!-- @if(showConfirmationModal){... } -->
