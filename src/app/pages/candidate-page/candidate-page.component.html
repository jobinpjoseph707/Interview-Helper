<div class="form-container">
  <h2>Candidate Form</h2>
  <form [formGroup]="candidateForm" (ngSubmit)="onSubmit()" class="candidate-form">
    <!-- Main form layout divided into two columns -->
    <div class="form-row">
      <!-- Left column for Name, Role, Interview Date -->
      <div class="left-column">
        <div class="form-group">
          <label *ngIf="!(candidateForm.get('name')?.invalid && candidateForm.get('name')?.touched)">Name</label>
          <div *ngIf="candidateForm.get('name')?.invalid && candidateForm.get('name')?.touched" class="error-message">
            <div *ngIf="candidateForm.get('name')?.errors?.['required']">Name is required.</div>
            <div *ngIf="candidateForm.get('name')?.errors?.['pattern']">Name should not contain numbers or special characters.</div>
          </div>
          <input type="text" id="name" formControlName="name" placeholder="Enter Name" />
        </div>

        <div class="form-group">
          <label *ngIf="!(candidateForm.get('role')?.invalid && candidateForm.get('role')?.touched)">Role</label>
          <div *ngIf="candidateForm.get('role')?.invalid && candidateForm.get('role')?.touched" class="error-message">
            <div *ngIf="candidateForm.get('role')?.errors?.['required']">Role is required.</div>
          </div>
          <select id="role" formControlName="role">
            <option value="" disabled selected>Select Role</option>
            <option *ngFor="let role of roleOptions" [value]="role.name">{{ role.name }}</option>
          </select>
        </div>

        <div class="form-group">
          <label *ngIf="!(candidateForm.get('interviewDate')?.invalid && candidateForm.get('interviewDate')?.touched)">Interview Date</label>
          <div *ngIf="candidateForm.get('interviewDate')?.invalid && candidateForm.get('interviewDate')?.touched" class="error-message">
            Interview Date is required.
          </div>
          <input type="date" id="interview-date" formControlName="interviewDate" />
        </div>
      </div>

      <!-- Right column for Stacks -->
      <div class="right-column">
        <div formArrayName="stacks">
          <div *ngFor="let stack of stacks.controls; let i = index" [formGroupName]="i">
            <div class="stack-row">
              <div class="form-group">
                <label *ngIf="!(stack.get('stackName')?.invalid && stack.get('stackName')?.touched)">Technology</label>
                <div *ngIf="stack.get('stackName')?.invalid && stack.get('stackName')?.touched" class="error-message">
                  Technology is required.
                </div>
                <select id="stackName-{{i}}" formControlName="stackName" (change)="onStackChange(i)">
                  <option value="" disabled>Select Technology</option>
                  <option *ngFor="let option of stackOptions" [value]="option.technology">{{ option.technology }}</option>
                </select>
              </div>

              <div class="form-group">
                <label *ngIf="!(stack.get('experienceLevel')?.invalid && stack.get('experienceLevel')?.touched)">Experience Level</label>
                <div *ngIf="stack.get('experienceLevel')?.invalid && stack.get('experienceLevel')?.touched" class="error-message">
                  Experience Level is required.
                </div>
                <select id="experienceLevel-{{i}}" formControlName="experienceLevel">
                  <option value="" disabled>Select Experience Level</option>
                  <option *ngFor="let exp of getExperienceOptions(stack.get('stackName')?.value)" [value]="exp">{{ exp }}</option>
                </select>
              </div>

              <div class="add-button-container">
                <button type="button" (click)="addStack()" class="add-button" *ngIf="i === stacks.controls.length - 1 && stack.get('stackName')?.value">
                  <img src="https://img.icons8.com/?size=100&id=37839&format=png&color=538f76" alt="Add Icon" class="icon" />
                </button>
              </div>

              <button *ngIf="i > 0" type="button" (click)="removeStack(i)" class="remove-button">
                <img src="https://img.icons8.com/?size=100&id=59754&format=png&color=af4949" alt="Remove Icon" class="icon" />
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Submit button -->
    <button type="submit" [disabled]="candidateForm.invalid" class="submit-button">Submit</button>
  </form>
</div>
